<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div layout:fragment="content">
    <div class="container mt-5">
        <!-- Title -->
        <h1 class="text-center text-uppercase text-danger mb-4">Kho Hàng</h1>

        <!-- Button Group -->
        <div class="btn-group d-flex justify-content-center mb-4" role="group">
            <button id="statsByName" class="btn btn-outline-danger">Kiểm tra theo tên</button>
            <button id="statsByCategory" class="btn btn-outline-success">Kiểm tra theo loại</button>
            <button id="statsByManufacturer" class="btn btn-outline-info">Kiểm tra theo hãng</button>
        </div>

        <!-- Table for Results -->
        <div id="statsResult" class="results table-responsive">
            <!-- Dynamic table will be rendered here -->
        </div>
    </div>

    <script>
        let currentPage = 0; // Current page
        const pageSize = 10; // Items per page

        // Fetch statistics with pagination
        async function fetchStats(url, type) {
            try {
                const response = await fetch(`${url}?page=${currentPage}&size=${pageSize}`);
                const data = await response.json();
                displayResults(data, type);
            } catch (error) {
                console.error(`Error fetching stats from ${url}:`, error);
            }
        }

        // Fetch stats by product name
        function getStatsByName() {
            fetchStats('/admin/api/product/stats-by-name', 'Tên Sản Phẩm');
        }

        // Fetch stats by category
        function getStatsByCategory() {
            fetchStats('/admin/api/product/stats-by-category', 'Loại Sản Phẩm');
        }

        // Fetch stats by manufacturer
        function getStatsByManufacturer() {
            fetchStats('/admin/api/product/stats-by-manufacturer', 'Hãng Sản Xuất');
        }

        // Display results in a table with pagination
        function displayResults(data, type) {
            const resultDiv = document.getElementById('statsResult');
            resultDiv.innerHTML = '';

            let table = `
                <table class="table table-hover table-bordered align-middle">
                    <thead class="table-danger text-center">
                        <tr>
                            <th>${type}</th>
                            <th>Số Lượng</th>
                        </tr>
                    </thead>
                    <tbody>`;

            data.forEach(item => {
                table += `
                    <tr>
                        <td class="text-center">${item[`${type.toLowerCase().replace(/\s/g, '')}Name`]}</td>
                        <td class="text-center">${item.count}</td>
                    </tr>`;
            });

            table += `
                    </tbody>
                </table>`;
            resultDiv.innerHTML = table;

            // Add pagination
            const pagination = `
                <div class="d-flex justify-content-center mt-3">
                    <button class="btn btn-outline-secondary" ${currentPage === 0 ? 'disabled' : ''} onclick="prevPage()">Previous</button>
                    <button class="btn btn-outline-secondary ms-2" onclick="nextPage()">Next</button>
                </div>`;
            resultDiv.innerHTML += pagination;
        }

        function prevPage() {
            if (currentPage > 0) {
                currentPage--;
                reloadCurrentStats();
            }
        }

        function nextPage() {
            currentPage++;
            reloadCurrentStats();
        }

        function reloadCurrentStats() {
            const activeButton = document.querySelector('.btn-group .active');
            if (activeButton.id === 'statsByName') getStatsByName();
            if (activeButton.id === 'statsByCategory') getStatsByCategory();
            if (activeButton.id === 'statsByManufacturer') getStatsByManufacturer();
        }

        // Event Listeners
        document.getElementById('statsByName').addEventListener('click', () => {
            currentPage = 0;
            getStatsByName();
        });
        document.getElementById('statsByCategory').addEventListener('click', () => {
            currentPage = 0;
            getStatsByCategory();
        });
        document.getElementById('statsByManufacturer').addEventListener('click', () => {
            currentPage = 0;
            getStatsByManufacturer();
        });
    </script>
</div>
</body>
</html>
